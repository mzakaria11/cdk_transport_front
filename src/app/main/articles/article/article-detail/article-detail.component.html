
<div class="content-wrapper container-xxl p-0">
  <app-content-header [contentHeader]="contentHeader"></app-content-header>
    <div class="content-body">
      <section class="app-user-edit">
        <div class="card">
          <div class="card-body">
            <ul ngbNav #nav="ngbNav" class="nav nav-pills">
              <li ngbNavItem>
                <a ngbNavLink class="d-flex align-items-center"
                  ><i data-feather="box" class="mr-sm-50"></i><span class="d-none d-sm-block">Détail</span></a
                >
                <ng-template ngbNavContent>
                  <div class="tab-pane active" id="account" aria-labelledby="account-tab" role="tabpanel">
                    <form class="form-validate" (ngSubmit)="(articleForm.form.valid)" #articleForm="ngForm">

                      <div class="row">
                        <div class="col-md-4">
                          <div class="form-group" [ngClass]="{'pointer-events-none': !edit}">
                            <label for="codeClient">Code</label>
                            <input
                              type="text"
                              id="codeClient"
                              class="form-control"
                              placeholder="Code"
                              name="codeClient"
                              [(ngModel)]="article.codeClient"
                              [class.error]="articleForm.submitted && codeClientRef.invalid"
                              #codeClientRef="ngModel"
                              required
                            />
                            <span *ngIf="articleForm.submitted && codeClientRef.invalid" class="invalid-form">
                              <small class="form-text text-danger" *ngIf="codeClientRef.errors.required"
                                >Code est requis!</small
                              >
                            </span>
                          </div>
                        </div>
  
                        <div class="col-md-4">
                          <div class="form-group" [ngClass]="{'pointer-events-none': !edit}">
                            <label for="designationClient">Désignation</label>
                            <input
                              type="designationClient"
                              id="designationClient"
                              class="form-control"
                              placeholder="Désignation"
                              name="designationClient"
                              [(ngModel)]="article.designationClient"
                              [class.error]="articleForm.submitted && DesignationClientRef.invalid"
                              #DesignationClientRef="ngModel"
                              required
                            />
                            <span *ngIf="articleForm.submitted && DesignationClientRef.invalid" class="invalid-form">
                              <small class="form-text text-danger" *ngIf="DesignationClientRef.errors.required"
                                >Désignation est requis!</small
                              >
                            </span>
                          </div>
                        </div>

                        <div class="col-md-4" *ngIf="!hasRole.includes('Client')">
                          <div class="form-group" [ngClass]="{'pointer-events-none': !edit}">
                            <label for="UDFournisseur">Fournisseur</label>
                            <select
                              id="UDFournisseur"
                              name="fournisseur"
                              class="form-control"
                              [(ngModel)]="article.fournisseur.id"
                              #FournisseurRef="ngModel"
                              [class.error]="articleForm.submitted && FournisseurRef.invalid"
                            >
                              <option [ngValue]="">Tous</option>
                              <option *ngFor="let option of fournisseurs" [ngValue]="option.id">{{option.nom}}</option>
                            </select>
                            <span *ngIf="articleForm.submitted && FournisseurRef.invalid" class="invalid-form">
                              <small class="form-text text-danger" *ngIf="FournisseurRef.errors.required"
                                >Fournisseur est requis!</small
                              >
                            </span>
                          </div>
                        </div>
  
                        <div class="col-md-4">
                          <div class="form-group" [ngClass]="{'pointer-events-none': !edit}">
                            <label for="delaiPeremption">Délai Péremption</label>
                            <input
                              type="text"
                              id="delaiPeremption"
                              class="form-control"
                              placeholder="Délai Péremption"
                              name="delaiPeremption"
                              [(ngModel)]="article.delaiPeremption"
                              #delaiPeremptionRef="ngModel"
                            />
                            <!-- <span *ngIf="articleForm.submitted && delaiPeremptionRef.invalid" class="invalid-form">
                              <small class="form-text text-danger" *ngIf="delaiPeremptionRef.errors.required"
                                >Délai Péremption est requis!</small
                              >
                            </span> -->
                          </div>
                        </div>
  
                        <!-- <div class="col-md-4">
                          <div class="form-group" [ngClass]="{'pointer-events-none': !edit}">
                            <label for="dureeStockage">Durée Stockage</label>
                            <input
                              type="text"
                              id="dureeStockage"
                              class="form-control"
                              placeholder="Durée Stockage"
                              name="dureeStockage"
                              [(ngModel)]="article.dureeStockage"
                              #dureeStockageRef="ngModel"
                            />
                          </div>
                        </div> -->
  
                        <div class="col-md-4">
                          <div class="form-group" [ngClass]="{'pointer-events-none': !edit}">
                            <label for="quantiteColisStandard">Quantite Colis Standard</label>
                            <input
                              type="text"
                              id="quantiteColisStandard"
                              class="form-control"
                              placeholder="Quantite Colis Standard"
                              name="quantiteColisStandard"
                              [(ngModel)]="article.quantiteColisStandard"
                              #quantiteColisStandardRef="ngModel"
                            />
                          </div>
                        </div>
  
                        <div class="col-md-4">
                          <div class="form-group" [ngClass]="{'pointer-events-none': !edit}">
                            <label for="poidsColisStandard">Poids Colis Standard</label>
                            <input
                              type="text"
                              id="poidsColisStandard"
                              class="form-control"
                              placeholder="Poids Colis Standard"
                              name="poidsColisStandard"
                              [(ngModel)]="article.poidsColisStandard"
                              #poidsColisStandardRef="ngModel"
                            />
                          </div>
                        </div>   

                        <div class="col-md-4" *ngIf="!edit">
                          <div class="form-group">
                            <label for="quantiteProduitStockComplet">Quantité Produit Stock</label>
                            <input
                              type="text"
                              id="quantiteProduitStockComplet"
                              class="form-control pointer-events-none"
                              placeholder="quantité Produit Stock"
                              name="quantiteProduitStockComplet"
                              [(ngModel)]="article.quantiteProduitStockComplet"
                            />
                          </div>
                        </div>

                        <div class="col-md-4" *ngIf="!edit">
                          <div class="form-group">
                            <label for="quantiteColisStockComplet">Quantité Colis Stock</label>
                            <input
                              type="text"
                              id="quantiteColisStockComplet"
                              class="form-control pointer-events-none"
                              placeholder="quantité Colis Stock"
                              name="quantiteColisStockComplet"
                              [(ngModel)]="article.quantiteColisStockComplet"
                            />
                          </div>
                        </div>    

                        <div class="col-md-4" *ngIf="!edit">
                          <div class="form-group">
                            <label for="quantiteProduitStockIncomplet">Quantité Produit Stock incomplet</label>
                            <input
                              type="text"
                              id="quantiteProduitStockIncomplet"
                              class="form-control pointer-events-none"
                              placeholder="quantité Produit Stock incomplet"
                              name="quantiteProduitStockIncomplet"
                              [(ngModel)]="article.quantiteProduitStockIncomplet"
                            />
                          </div>
                        </div>

                        <div class="col-md-4" *ngIf="!edit">
                          <div class="form-group">
                            <label for="quantiteColisStockIncomplet">Quantité Colis Stock incomplet</label>
                            <input
                              type="text"
                              id="quantiteColisStockIncomplet"
                              class="form-control pointer-events-none"
                              placeholder="quantité Colis Stock incomplet"
                              name="quantiteColisStockIncomplet"
                              [(ngModel)]="article.quantiteColisStockIncomplet"
                            />
                          </div>
                        </div>    
    
                        <div class="col-12 d-flex flex-sm-row flex-column mt-2" *ngIf="edit && !hasRole.includes('Client')">
                          <button
                            type="submit"
                            (click)="submit(articleForm)"
                            class="btn btn-success mb-1 mb-sm-0 mr-0 mr-sm-1"
                            rippleEffect
                          >
                            Modifier
                          </button>
                          <button (click)="modalOpenForm(modalForm)" class="btn btn-outline-danger" *ngIf="hasRole.includes('Super_admin')" rippleEffect>
                            Supprimer
                          </button>
                        </div>
                      </div>
                    </form>
                                            
                    <div class="divider divider-left" *ngIf="!edit && !hasRole.includes('Client')">
                      <div class="divider-text">  
                        <div class="custom-control custom-switch custom-control-inline">
                          <input type="checkbox" class="custom-control-input" id="customSwitch1" [checked]="edit" (change)="updateNav()"/>
                          <label class="custom-control-label" for="customSwitch1">Basculez pour modifier</label>
                        </div>
                      </div>
                    </div>

                  </div>
                </ng-template>
              </li>
              
              <li ngbNavItem *ngIf="!hasRole.includes('Client') && !edit">
                <a ngbNavLink class="d-flex align-items-center">
                  <i data-feather="info" class="mr-sm-50"></i><span class="d-none d-sm-block">Liste destinataire</span></a
                >
                <ng-template ngbNavContent>
                  <!-- <div class="table-responsive">
                    <table class="table">
                      <thead>
                        <tr>
                          <th>Code UM</th>
                          <th>Destinataire</th>
                          <th>Délai</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let row of article.articlesDestinataires">
                          <td><span class="font-weight-bold"> {{ row.destinataire.identifiantSource }} </span></td>
                          <td> {{ row.destinataire.nom }} </td>
                          <td> {{ row.delaiPeremption }} </td>
                        </tr>
                      </tbody>
                    </table>
                  </div> -->
                  <div class="row">
                    <div class="col-md-6 col-12">
                      <div class="d-flex justify-content-between align-items-center m-1">
                        <label class="d-flex align-items-center">
                          Afficher
                          <select class="form-control mx-25" [(ngModel)]="selectedOption">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                            <option value="200">200</option>
                          </select>
                        </label>
                      </div>
                    </div>
                  </div>

                  <ngx-datatable
                    [rows]="article.articlesDestinataires"
                    [rowHeight]="'auto'"
                    class="bootstrap core-bootstrap"
                    [limit]="selectedOption"
                    [columnMode]="ColumnMode.force"
                    [headerHeight]="50"
                    [footerHeight]="50"
                    [scrollbarH]="true"
                    [messages]="{emptyMessage: 'Aucun article n\'a été trouvé', totalMessage:'Articles'}"
                  >
                    <ngx-datatable-column name="Code UM" prop="destinataire.codeUM" [width]="200">
                      <ng-template let-row="row" let-name="value" ngx-datatable-cell-template>
                        <div class="d-flex align-items-center">
                          <div class="cell-line-height">
                            <a class="font-medium-1 d-block"
                              ><span class="font-weight-bold">{{ row.destinataire.codeUM }}</span></a
                            >
                          </div>
                        </div>
                      </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column name="désignation" prop="destinataire.nom" [width]="200">
                      <ng-template let-row="row" let-name="value" ngx-datatable-cell-template>
                        <div class="d-flex align-items-center">
                          <div class="cell-line-height">
                            <a class="font-medium-1 d-block" routerLink="/destinataires/detail/{{row.destinataire.id}}"
                              ><span class="font-weight-bold">{{ row.destinataire.nom }}</span></a
                            >
                          </div>
                        </div>
                      </ng-template>
                    </ngx-datatable-column>
  
                    <ngx-datatable-column name="délai Péremption" prop="delaiPeremption" [width]="50">
                      <ng-template let-row="row" let-name="value" ngx-datatable-cell-template>
                        <div class="d-flex align-items-center">
                          {{ row.delaiPeremption }}
                        </div>
                      </ng-template>
                    </ngx-datatable-column>
                  </ngx-datatable>
                </ng-template>
              </li>
            </ul>
            <div [ngbNavOutlet]="nav" class="mt-2"></div>
          </div>
        </div>
      </section>
    </div>
</div>

<div class="content-wrapper container-xxl p-0" *ngIf="article.historiques.length > 0 && !hasRole.includes('Client') && !edit">
    <div class="content-body">
      <section class="app-user-edit">
        <div class="card">
          <div class="card-body">
            <div class="tab-pane active" id="account" aria-labelledby="account-tab" role="tabpanel">
              <div class="row">
                <div class="col-12">
                  <div class="table-responsive border rounded mt-1">
                    <h6 class="py-1 mx-1 mb-0 font-medium-2">
                      <i data-feather="archive" [size]="20" class="mr-25"></i>
                      <span class="align-middle">Historiques</span>
                    </h6>
                    <table class="table table-striped table-borderless">
                      <thead class="thead-light">
                        <tr>
                          <th>Code</th>
                          <th>Désigantion</th>
                          <th>Fournisseur</th>
                          <th>Durée stockage</th>
                          <th>Poid</th>
                          <th>Délai péremption</th>
                          <th>Date</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let row of article.historiques">
                          <td>{{row.codeClient}}</td>
                          <td> {{ row.designationClient }} </td>
                          <td> {{article.fournisseur.nom}} </td>
                          <td> {{ row.dureeStockage || '-' }} </td>
                          <td> {{ row.poids || '-' }} </td>
                          <td> {{ row.delaiPeremption || '-' }} </td>
                          <td> {{ row.chorodatage | date: 'dd MMMM,yyyy HH:mm' }} </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
    
            </div>
          </div>
        </div>
      </section>
    </div>
</div>

<div class="content-wrapper container-xxl p-0" *ngIf="!hasRole.includes('Client') && !edit">
  <div class="content-body">
    <section class="users-list-wrapper">
      <div class="card">
        <h4 class="card-title pt-20 pl-20 mb-0">Unité manutention entrée</h4>
        <div class="row">
          <div class="col-md-6 col-12">
            <div class="d-flex justify-content-between align-items-center m-1">
              <label class="d-flex align-items-center"
                >Afficher
                <select class="form-control mx-25" [(ngModel)]="selectedOption">
                  <option value="10">10</option>
                  <option value="25">25</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                </select>
              </label
              >
            </div>
          </div>
          <div class="col-md-6 col-12 d-flex justify-content-start justify-content-md-end">
            <div class="d-flex align-items-center justify-content-end pr-1 pb-1 pb-md-0">
            </div>
          </div>
        </div>
        <ngx-datatable
          [rows]="article['listUme']"
          [rowHeight]="50"
          class="bootstrap core-bootstrap"
          [limit]="selectedOption"
          [columnMode]="ColumnMode.force"
          [headerHeight]="50"
          [footerHeight]="50"
          [scrollbarH]="true"
          [messages]="{emptyMessage: 'Aucun unité manutention n\'a été trouvé', totalMessage:'UM'}"
        >
          <ngx-datatable-column name="UME" [sortable]="false" [width]="10">
            <ng-template let-row="row" let-name="value" ngx-datatable-cell-template>
              <div class="d-flex align-items-center col-actions">
                <div
                  class="avatar avatar-status bg-light-secondary"
                  routerLink="/ume/detail/{{row.id}}"
                >
                  <ng-template #tipContent>
                    <span>
                      {{row.id}}
                    </span>
                  </ng-template>
                  <span class="avatar-content" placement="top" [ngbTooltip]="tipContent" container="body">
                    <i 
                      class="feather avatar-icon font-medium-1"
                      data-feather="arrow-right"
                    ></i>
                  </span>
                </div>
              </div>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column name="Bon de livraison entré" prop="numero" [width]="400">
            <ng-template let-row="row" let-name="value" ngx-datatable-cell-template>
              <div class="d-flex align-items-center">
                <div class="cell-line-height">
                  <a class="font-medium-1 d-block" routerLink="/ble/detail/{{row.ble.id}}"
                    ><span class="font-weight-bold"># {{ row.ble ? row.ble.numeroBonLivraison : '-' }}</span></a
                  >
                </div>
              </div>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column name="Zone depot" prop="zoneDepot" [width]="400">
            <ng-template let-row="row" ngx-datatable-cell-template>
              <div>
                {{ row.zoneDepot ? row.zoneDepot.nom : '-' }}
              </div>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column name="Date réception" prop="dateReception" [width]="400">
            <ng-template let-row="row" ngx-datatable-cell-template>
              <div>
                {{ row.dateReception | date: 'dd-MM-yyyy' }}
              </div>
            </ng-template>
          </ngx-datatable-column>

        </ngx-datatable>
      </div>
    </section>
  </div>
</div>

<div class="login-form"> 
  <ng-template #modalForm let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="myModalLabel1">Confirmation de suppression</h4>
      <button type="button" class="close" (click)="modal.dismiss('Cross click')" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body" tabindex="0" ngbAutofocus>
      <form class="form-validate" [formGroup]="ReactivePasswordConfirmationForm" (ngSubmit)="ReactiveCPFormOnSubmit()">
        <div class="row">

          <div class="col-md-12">
            <div class="form-group">
              <div class="form-group">
                  <label for="password">Mot de passe</label>
                  <input
                    type="password"
                    id="password"
                    formControlName="password"
                    class="form-control"
                    [ngClass]="{ 'is-invalid': ReactiveCPFormSubmitted && ReactiveCPForm.password.errors }"
                  />
                  <div
                    *ngIf="ReactiveCPFormSubmitted && ReactiveCPForm.password.errors"
                    class="invalid-feedback"
                  >
                    <div *ngIf="ReactiveCPForm.password.errors.required">Mot de passe est requis</div>
                    <div *ngIf="ReactiveCPForm.password.errors.minlength">Mot de passe doit comporter au moins 6 caractères</div>
                  </div>
                </div>
            </div>
          </div>
          <div class="modal-footer" style="width: 100%;">
            <button class="btn btn-primary" rippleEffect>
              Confirmer
            </button>
          </div>
        </div>
      </form>
    </div>
  </ng-template>
</div>